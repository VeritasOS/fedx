<html>
<head>
	<title>FedX Documentation</title>
</head>

<body>
<div id="content" style="width:800px">

<h2>Using FedX in the RDF4J Workbench</h2>

<a href="../Index.html">back</a>

<p>FedX can be configured as a Repository in the RDF4J Workbench, e.g. to use 
the inherent infrastructure for publishing the federation as a single SPARQL
endpoint.
</p>

<h3>Steps</h3>

<ul>
	<li>Follow the documentation on <a href="http://docs.rdf4j.org/server-workbench-console/" target="_BLANK">http://docs.rdf4j.org/server-workbench-console/</a> 
	to setup and deploy the RDF4J workbench</li>
	<li>Start the RDF4J workbench once and make sure it is running. Then shutdown the webserver</li>
	<li>Deploy the FedX binary (i.e. fedx-6.0.0.jar) in the <i>rdf4j-server</i> webapp (e.g. in a standard Tomcat installation to <i>&lt;TOMCAT-HOME&gt;/webapps/rdf4j-server/WEB-INF/lib/fedx-6.0.0.jar</i>)</li>
	<li>Optionally configure the <i>rdf4j-server</i> web application to inject the RDF4J repository resolver into FedX (see next section for details)
	<li>Create a FedX repository
		<ul>
			<li>Locate the RDF4J application directory (Hint: see <a href="http://docs.rdf4j.org/server-workbench-console/#_application_directory_configuration" target="_BLANK">http://docs.rdf4j.org/server-workbench-console/#_application_directory_configuration</a>)</li>
			<li>Create a FedX repository configuration by copying the required files (see "Sample Configuration") to the <i>repositories</i> directory (that exists in teh application directory)</li>
		</ul>
	</li>
	<li>Restart the RDF4J workbench and check the state of the FedX federation
	
</ul>

<p><b>Notes</b></p>

<ul>
	<li>Logging output can be found in <i>logs/main.log</i> (in the RDF4J application directory) as well as
	in the tomcat logs (e.g. catalina.out and catalina.log)
</ul>


<h3>Injecting the RDF4J repository manager into FedX</h3>

<p>In order to access a repository managed within the RDF4J Server itself (e.g. a local native store), FedX needs to
be made aware of how to resolve the repository. This can be achieved by injecting the RDF4J repository manager into
FedX as described in the following.</p>

<ul>
	<li>Locate the <i>rdf4j-server</i> webapp configuration (e.g. <i>&lt;TOMCAT-HOME&gt;/webapps/rdf4j-server/WEB-INF/rdf4j-http-server-servlet.xml</i>)</li>
	<li>Add the following snippet below the definition of the <i>rdf4jRepositoryManager</i> bean to configure the FedX repository resolver</li>
</ul>

<pre>
&lt;!-- Inject the local repository manager as RepositoryResolver into FedX --&gt;
&lt;bean id="fedxRepositoryResolver"
	class="com.fluidops.fedx.repository.FedXRepositoryResolverBean"
	scope="singleton" init-method="init" destroy-method="destroy"&gt;
	&lt;property name="repositoryResolver" ref="rdf4jRepositoryManager" /&gt;
&lt;/bean&gt;
</pre>

<p>With this configuration it is possible to reference any existing repository managed by the RDF4J Server as
<i>ResolvableEndpoint</i> in the data configuration. See below for an example.


<h3>Sample Repository configuration</h3>

<p>Repositories in the RDF4J workbench are configured using <i>config.ttl</i> files in the <i>repositories</i>
folder of the application directory.</p>

<p>Each repository is represented by a folder (i.e. the data directory) and a <i>config.ttl</i> file. For FedX we
require two additional files, the <i>fedx configuration file</i> and the <i>data configuration file</i> (representing 
the federation members).<p>

<p>
In order to configure FedX create the configuration the samples below. If the configuration was successful, you
can access the SPARQL endpoint at <i>http://localhost:8080/rdf4j-workbench/repositories/%myFederation%/summary</i>.
The SPARQL endpoint is accessible at <i>http://localhost:8080/rdf4j-server/repositories/%myFederation%</i>.
</p>

<p><b>Directory structure</b><p>

<pre>
/repositories
  + myFederation
    - config.ttl
    - fedxConfig.prop
    - dataConfig.ttl
</pre>

Note that <i>myFederation</i> is the repository identifier in the RDF4J workbench. This must the same as the <i>repositoryId</i> in config.ttl.

<p><b>config.ttl</b></p>

<pre>
#
# RDF4J configuration template for a FedX Repository
#
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix rep: &lt;http://www.openrdf.org/config/repository#&gt; .
@prefix fedx: &lt;http://www.fluidops.com/config/fedx#&gt; .

[] a rep:Repository ;
   rep:repositoryImpl [
      rep:repositoryType "fedx:FedXRepository" ;
      fedx:fedxConfig "fedxConfig.prop" ;
      fedx:dataConfig "dataConfig.ttl" ;
   ];
   rep:repositoryID "myFederation" ;
   rdfs:label "FedX Federation" .
</pre>

<p>
Note that locations are relative to the data directory.</p>


<p><b>fedxConfig.prop</b></p>

<p>Specifies the configuration of FedX, see the documentation on <a href="configuration.html">configuration</a> for details.</p>

<pre>
# FedX Configuration
#
# Have a look at the documentation to get information on
# possible configuration settings

#debugQueryPlan = true
</pre>


<p><b>dataConfig.ttl</b></p>

<p>This file specifies the federation members, see the documentation on <a href="dataConfig.html">data configurations</a> for details.</p>

<pre>
@prefix sd: &lt;http://www.w3.org/ns/sparql-service-description#&gt; .
@prefix fedx: &lt;http://www.fluidops.com/config/fedx#&gt; .

&lt;http://myNtiveStore&gt; a sd:Service ;
	fedx:store "ResolvableRepository" ;
	fedx:repositoryName "myNativeStore" .
	
&lt;http://DBpedia> a sd:Service ;
	fedx:store "SPARQLEndpoint";
	fedx:SPARQLEndpoint "http://dbpedia.org/sparql";
	fedx:supportsASKQueries "false" .
</pre>

</div>
</body>
</html>